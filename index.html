<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <!-- 1. PUBLIC LANDING PAGE (Dynamic based on Agency) -->
    <div id="public-landing">
        <nav class="landing-nav">
            <div id="lp-logo" style="font-weight:bold; font-size:1.5rem; color:var(--primary);">Platform</div>
            <button onclick="showLoginModal()" class="btn">Login / Join</button>
        </nav>
        <div class="landing-hero">
            <h1 id="lp-title">Build Your Business</h1>
            <p id="lp-desc">The all-in-one platform for merchants and suppliers.</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button onclick="setRegRole('merchant')" class="btn">Start a Shop (Merchant)</button>
                <button onclick="setRegRole('supplier')" class="btn btn-outline">Become a Supplier</button>
            </div>
        </div>
        <div class="card" style="max-width:800px; margin:0 auto; text-align:center;">
            <h3>Powered by <span id="lp-agency-name">Super Platform</span></h3>
            <p>Join thousands of entrepreneurs making money online.</p>
        </div>
    </div>

    <!-- 2. AUTH MODAL -->
    <div id="auth-modal" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:100;">
        <div class="card" style="width:100%; max-width:400px; position:relative;">
            <button onclick="document.getElementById('auth-modal').classList.add('hidden')" style="position:absolute; right:15px; top:15px; background:none; border:none; font-size:1.5rem;">&times;</button>
            <h2 id="auth-title">Login</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Password">
            
            <!-- Hidden inputs for registration -->
            <div id="reg-fields" class="hidden">
                <input type="text" id="reg-name" placeholder="Business/Name">
                <select id="reg-role-select">
                    <option value="merchant">Merchant (Seller)</option>
                    <option value="supplier">Supplier (Product Source)</option>
                    <option value="agency">Agency (Software Reseller)</option>
                </select>
            </div>

            <button onclick="handleAuth()" class="btn" style="width:100%;">Continue</button>
            <p style="text-align:center; margin-top:10px; cursor:pointer; color:blue;" onclick="toggleAuthMode()">Switch to Register/Login</p>
        </div>
    </div>

    <!-- 3. DASHBOARD (All Roles) -->
    <div id="dashboard" class="dashboard-container hidden">
        <aside class="sidebar">
            <h3 id="dash-brand" style="margin-bottom:30px;">Dashboard</h3>
            <nav id="sidebar-menu">
                <!-- Menu items injected via JS -->
            </nav>
            <button onclick="logout()" class="btn btn-outline" style="margin-top:auto; border-color:#475569; color:white;">Logout</button>
        </aside>
        <main class="main-content" id="main-view">
            <!-- Content injected via JS -->
        </main>
    </div>

    <div id="toast" style="position:fixed; bottom:20px; right:20px; background:#333; color:white; padding:10px 20px; border-radius:5px; display:none;"></div>

    <script type="module" src="app.js"></script>
    <script>
        // Helper to show/hide elements safely
        function toggleModal(show) {
            const modal = document.getElementById('auth-modal');
            if (show) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex'; // Ensure flex is applied for centering
            } else {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }

        // Open Login Modal
        function showLoginModal() { 
            toggleModal(true);
        }

        // Close Login Modal (Attached to the X button)
        document.querySelector('#auth-modal button').onclick = function() {
            toggleModal(false);
        };

        // Switch between Merchant/Supplier Registration
        let isRegister = false;
        
        function toggleAuthMode() {
            isRegister = !isRegister;
            const regFields = document.getElementById('reg-fields');
            
            if (isRegister) {
                regFields.classList.remove('hidden');
            } else {
                regFields.classList.add('hidden');
            }
            
            document.getElementById('auth-title').innerText = isRegister ? 'Create Account' : 'Login';
        }

        function setRegRole(role) {
            toggleModal(true); // Open modal
            
            // Switch to Register Mode
            isRegister = true;
            document.getElementById('reg-fields').classList.remove('hidden');
            document.getElementById('auth-title').innerText = 'Create Account';
            
            // Set the dropdown value
            const select = document.getElementById('reg-role-select');
            if(select) select.value = role;
        }

        // Make functions available globally so HTML buttons can see them
        window.showLoginModal = showLoginModal;
        window.toggleAuthMode = toggleAuthMode;
        window.setRegRole = setRegRole;
    </script>
</body>
</html>
